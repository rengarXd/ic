<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>医生评价body</title>
		<link rel="stylesheet" type="text/css" href="../../css/aui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/fonts/iconfont.css"/>
		<style>
			.wenzhen_btn_wen {
				color: #fff;
				position: fixed;
				bottom: 0;
				border-radius: 0;
				margin: 0;
				border: 0;
				background: -webkit-gradient(linear, left top, left bottom, from(#ff7f27), to(#ff6001));
			}
			.wenzhen_btn_wen:active {
				background: -webkit-gradient(linear, left top, left bottom, from(#ff6001), to(#ff9001));
			}
			.aui-input-row .aui-input-addon {
				padding-left: 20px;
			}
			.bsy {
				font-size: 12px;
				color: #A0A0A0;
				margin-left: 20px;
			}
			.aui-input-rows:first-child:after {
				border-top: 0
			}
			.aui-input-rows {
				display: block;
				padding: 0
			}
			.pj {
				height: 40px;
				line-height: 40px;
				font-size: 15px;
				padding-left: 20px;
				color: #A0A0A0;
			}
			.aui-pull-right {
				padding-top: 5px;
				padding-right: 9px;
			}
			#massage {
				font-size: 13px;
				margin-top: 20px;
				color: #A5A3A3;
			}
			.ic_success {
				color: #7D7878;
				background: #FBF8F8;
				border: 1px solid #ddd;
				padding: 5px;
				margin-top: 20px;
				font-size: 14px;
			}
			.ic_success:active {
				background: #ddd
			}
			.ic_font {
				font-size: 30px;
				padding-left: 10px;
				line-height: 70px;
				color: #7D7878;
				font-family: Georgia;
				background: #FFFFFF;
			}
		</style>
	</head>
	<body>
		<div class="aui-content" style="background: #fff;margin-top: 10px">
			<span class="pj" >评价<div class="aui-pull-right" id="jRate"></div></span>
			<div id="demo-onchange-value"></div>
			<div class="aui-form">
				<div class="aui-input-row aui-input-rows">
					<textarea class="aui-input" placeholder="请您给此次购物做一个评价，有助于我们更好的服务" id="content" style="height: 140px;"></textarea>
				</div>
			</div>
		</div>
		<!--撑开下部层页面-->
		<div style="height:10px;"></div>
		<!--撑开下部层页面-->
		<!--我要问诊-->
		<div class="aui-btn aui-btn-block wenzhen_btn_wen" id="consulting">
			提交评价
		</div>
	</body>
	<script type="text/javascript" src="../../script/AHelper.js"></script>
	<script type="text/javascript" src="../../script/star/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="../../script/star/jRate.js"></script>
	<script type="text/javascript">
		var retobj = null, result = null, pjId = null;
		$("#jRate").jRate({
			backgroundColor : 'white',
			startColor : '#ff7f27',
			endColor : '#ff7f27',
			strokeColor : 'black',
			opacity : 0.3,
			precision : 0.1,
			onChange : function(rating) {
				result = rating;
			}
		});
		$("#consulting").on("click", function() {
			var content = $("#content").val();
			if (result != null) {
				if (content) {
					api.showProgress({
						title : '正在提交'
					});
					api.ajax({
						url : window.serverUrl + '/comment_add/token/' + retobj.token + '/user_id/' + retobj.id,
						data : {
							values : {
								"comment_id" : pjId.id,
								"content" : content,
								"point" : result
							}
						}
					}, function(ret, err) {
						if (ret && ret.retCode == 1) {
							api.hideProgress();
							api.alert({
								title : '温馨提示',
								msg : JSON.stringify(ret.retDesc),
								buttons : ['确定']
							}, function(ret, err) {
								H.$openWin("shop_order_finish_header", "shop_order_finish_header.html", {
									ordersId : pjId.ordersId,
									type : 4
								});
							});
						} else if (ret.retCode == 0) {
							api.hideProgress();
							api.toast({
								msg : ret.retDesc
							});
						} else {
							api.hideProgress();
							alert(JSON.stringify(err.msg));
						}
					});
				} else {
					api.toast({
						msg : '提交前，请添加评价'
					});
				}
			} else {
				api.toast({
					msg : '请评价星级'
				});
			}
		});
		H.ready(function() {
			api.parseTapmode();
			pjId = H.$getPageParam();
			console.log(JSON.stringify(pjId));
			api.getPrefs({
				key : 'userinfo'
			}, function(ret, err) {
				retobj = eval('(' + ret.value + ')');
			});
		});
	</script>
</html>