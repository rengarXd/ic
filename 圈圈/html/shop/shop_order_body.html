<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>订单详情body</title>
		<link rel="stylesheet" type="text/css" href="../../css/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../css/fonts/iconfont.css" />
		<style>
			.ic_zl_icon {
				display: block;
				font-size: 20px;
			}
			.q_address {
				font-size: 19px;
				/* font-weight: 800; */
				color: #1786FF !important;
			}
			.q_addressd {
				color: #1786FF;
				font-size: 15px;
			}
			.products_no {
				
				font-size: 12px !important;
				color: #bbb;
			}
			.ways{
				margin-right: 16px;
			}
			.aui-content{
				background:#fff;
			}
			
			.aui-nav .aui-bar-tab {
				background: #34495E;
			}
			.aui-nav .aui-bar-tab li .aui-iconfont, .aui-nav .aui-bar-tab li p {
				color: #fff;
			}
			.aui-nav .aui-bar-tab li.active .aui-iconfont, .aui-nav .aui-bar-tab li.active p {
				color: #14bd7c;
			}
			.aui-nav {
				background: #fff;
				font-size: 18px;
				color: #fff;
				text-align: center;
			}
			.aui-nav  div {
				height: 55px;
			}
			.aui-nav .buy {
				line-height: 55px;
				background: -webkit-gradient(linear, left top, left bottom, from(#ff7f27), to(#ff6001));
			}
			.ms_info {
				line-height: 55px;
			}
			.ms_font {
				font-size:15px !important;
				color: #000000 !important;
			}
		</style>
	</head>
	<body>
		<div id="cart_html"></div>
		<!--撑开相应高度-->
		<div style="height: 55px;"></div>
		<!--撑开相应高度-->
		<footer class="aui-nav" id="aui-footer">
			<div class="aui-col-xs-8">
				<div class="aui-col-xs-6 ms_info">
					<p class="ms_font">
						共<span style="color: #fd0202;">*</span>件商品
					</p>
				</div>
				<div class="aui-col-xs-6 ms_info">
					<p class="ms_font">
						总价：￥<span style="color: #fd0202;">1000</span>元
					</p>
				</div>
			</div>
			<div class="aui-col-xs-4 buy" id="buy" tapmode >
				提交订单
			</div>
		</footer>
		<script type="text/html" id="cart_data">
			<div class="aui-content">
			<ul class="aui-list-view">
			<li class="aui-list-view-cell" onclick="openAddress();" >
			<div class="aui-arrow-right" style="margin: 8px 0 8px 0;">
			<div class="aui-col-xs-1">
			<span class="iconfont icon-dingweidizhigpsditu ic_zl_icon"></span>
			</div>
			<div class="aui-col-xs-11">
			<span style="float: left">收货人：<span id="shouhuoren">{{ d.retValue.address[0].accept_name }}</span></span>
			<span class="aui-pull-right" style="margin-right: 12px;" id="telephone">{{ d.retValue.address[0].mobile }}</span><br />
			<p style="margin-top: 5px;" >
			收货地址：<span id="addressInfo">{{ d.retValue.address[0].province_val }} {{ d.retValue.address[0].city_val }} {{ d.retValue.address[0].area_val }} {{ d.retValue.address[0].address }}；
			</span>
			</p>
			</div>
			</div>
			</li>
			{{# for(var a = 0, b = d.retValue.address.length; a < b; a++) { }}
			<li class="aui-list-view-cell address_list" style="display: none;">
			<div style="margin: 8px 0 8px 0;">
			<div class="aui-col-xs-2" >
			<input class="aui-radio" type="radio" name="demo1" onclick="closeAddress({{ a }});">
			</div>
			<div class="aui-col-xs-10">
			<span style="float: left" >收货人：{{ d.retValue.address[a].accept_name }}<span class="aui-pull-right" style="margin-right: 12px;" >{{ d.retValue.address[a].mobile}}</span>
			<p style="margin-top: 5px;" >
			收货地址：{{ d.retValue.address[a].province_val }} {{ d.retValue.address[a].city_val }} {{ d.retValue.address[a].area_val }} {{ d.retValue.address[a].address }}；
			</p> </span>
			</div>
			</div>
			</li>
			{{# } }}
			<li class="aui-list-view-cell address_list" style="display: none;">
			<div class="q_addressd" onclick="add_page();" style="text-align: center;">
			<span class="iconfont icon-14052229 q_address"></span>&nbsp;&nbsp;新增地址
			</div>
			</li>
			</ul>
			</div>
			<div class="aui-content">
			
			<ul class="aui-list-view">
			<li class="aui-list-view-cell">
			<span class="products_no">商家编号:{{ d.retValue.goodsList[0].goods_no }}</span>
			</li>
			<li class="aui-list-view-cell" style="background: #f4f4f4">
			<div class="aui-col-xs-3">
			<img src="http://122.114.90.191/{{ d.retValue.goodsList[0].img }}" style="height: 50px !important;"/>
			</div>
			<div class="aui-col-xs-9">
			<span style="font-size: 15px;line-height: 5px !important;">{{ d.retValue.goodsList[0].name }}</span>
			<br />
			<span style="font-size: 12px;">
			{{# if (contents.content) { }}
			商品型号：{{ JSON.stringify(contents.content) }}
			{{# } }}
			</span>
			<br />
			<span style="color:#fd0202">￥{{ d.retValue.goodsList[0].sell_price }}
			<span class="aui-pull-right">x
			<span id="countNum">
			{{# if (contents.num){ }}
			{{ contents.num }}
			{{# }else{ }}
			{{ d.retValue.goodsList[0].count }}
			{{# } }}
			</span>
			</span>
			</span>
			</div>
			</li>
			<li class="aui-list-view-cell">
			<div class="aui-col-xs-6">
			购买数量
			</div>
			<div class="aui-col-xs-6">
			<div class="aui-counter aui-danger aui-pull-right">
			<div class="aui-counter-minus aui-disabled" onclick="minus();"></div>
			<input class="aui-counter-input" type="number" value="1" id="member">
			<div class="aui-counter-plus" onclick="plus();"></div>
			</div>
			</div>
			</li>
			<li class="aui-list-view-cell">
			<span>商家类别<span class="aui-pull-right">商城自营</span></span>
			</li>
			<li class="aui-list-view-cell" onclick="Distribution();">
			<span class="aui-arrow-right">配送方式<span class="aui-pull-right ways" id="delivery" deliveryVal="" ></span></span>
			</li>
			<li class="aui-list-view-cell" onclick="payMent();">
				<a class="aui-arrow-right">支付方式<span class="aui-pull-right ways" id="payments" payment=""></span></a>
			</li>
			</ul>
			</div>
			<div class="aui-content">
			<ul class="aui-list-view">
			<li class="aui-list-view-cell" onclick="active_message();">
			<div class="aui-arrow-right" >
			活动信息
			</div>
			</li>
			{{# for(var i = 0, len = d.retValue.prop.length; i < len; i++){ }}
			<li class="aui-list-view-cell active_list" style="display: none;">
			<div class="aui-col-xs-2">
			<input class="aui-radio" type="radio" name="demo" onclick="closeActive();">
			</div>
			<div class="aui-col-xs-10">
			<span ><span>{{ d.retValue.prop[i].name }}</span><br /><span>代金卷编号{{ d.retValue.prop[i].card_name }}</span><span class="aui-pull-right">抵用金额：{{ d.retValue.prop[i].value }}</span></span>
			</div>
			</li>
			{{# } }}
			</ul>
			</div>
		</script>
	</body>
	<script type="text/javascript" src="../../script/AHelper.js"></script>
	<script type="text/javascript" src="../../script/zepto.min.js"></script>
	<script type="text/javascript" src="../../script/laytpl.js"></script>
	<script type="text/javascript">
		var retabc = null, contents = null, result = null;
		//1、获取数据
		function get_data() {
			//请求ajax数据
			api.ajax({
				url : window.serverUrl + '/cart2/token/' + retabc.token + '/type/goods' + '/user_id/' + retabc.id + '/id/' + contents.goodId,
			}, function(ret, err) {
				if (ret && ret.retCode == 1) {
					result = ret;
					//alert(JSON.stringify(ret.retValue.address))
					var t = document.getElementById('cart_data').innerHTML;
					laytpl(t).render(ret, function(render) {
						document.getElementById('cart_html').innerHTML = render;
						api.parseTapmode();
					});
				} else {
					api.toast({
						msg : JSON.stringify(err)
					});
				}
			});
		}
		//2、打开地址选择
		function openAddress() {
			//			H.$openWin("user_shop_address_header", "../me/user_shop_address_header.html");
			$(".address_list").toggle();
		}
		//2.1、关闭地址选择器并选择相应地址
		function closeAddress(a) {
			$(".address_list").hide();
			$("#shouhuoren").html(result.retValue.address[a].accept_name);
			$("#telephone").html(result.retValue.address[a].mobile);
			$("#addressInfo").html(result.retValue.address[a].province_val + result.retValue.address[a].province_val + result.retValue.address[a].city_val + result.retValue.address[a].area_val + result.retValue.address[a].address);
			var data = {
				person : result.retValue.address[a].accept_name,
				addressInfo : result.retValue.address[a].province_val + result.retValue.address[a].province_val + result.retValue.address[a].city_val + result.retValue.address[a].area_val + result.retValue.address[a].address,
				telephone : result.retValue.address[a].mobile
			}
		}

		/*
		 处理商品数量加
		 * */
		function plus() {
			//4、处理数量加
			//4.1 获取最新数量
			var member = $("#member").val();
			//4.2 转整型
			var m = parseInt(member);
			//4.2 数量+1
			$("#member").val(m + 1);
			//4.3 判断数量
			if (m >= 1) {
				$(".aui-counter-minus").removeClass('aui-disabled');
			}
			$("#countNum").html(++member);
		}
		/*处理数量减*/
		function minus() {
			//5.1 获取最新的数量
			var members = $("#member").val();
			//5.2 字符串转换为整型
			var ms = parseInt(members);
			if (ms < 2) {
				$(".aui-counter-minus").addClass('aui-disabled');
			} else {
				$("#member").val(ms - 1);
			}
			$("#countNum").html($("#member").val());
		}
		//选择配送方式
		function Distribution() {
			api.actionSheet({
				title:'请选择配送方式',
				cancelTitle:'取消',
				buttons:['快递','货到付款']	
            },function(ret,err){
            	switch(ret.buttonIndex) {
							case 1:
								$("#delivery").html("快递");
								$("#delivery").attr("deliveryVal", 1);
								break;
							case 2:
								$("#delivery").html("货到付款");
								$("#delivery").attr("deliveryVal", 2);
								break;
						};
            });
		}
		//选择支付方式
		function payMent() {
			api.actionSheet({
				title:'请选择支付方式',
				cancelTitle:'取消',
				buttons:['预存款','在线支付']	
            },function(ret,err){
            	switch(ret.buttonIndex) {
							case 1:
								$("#payments").html("预存款");
								$("#payments").attr("payment", 1);
								break;
							case 2:
								$("#payments").html("在线支付");
								$("#payments").attr("payment", 11);
								break;
						};
            });
		}
		//活动信息选择器
		function active_message() {
			$(".active_list").toggle();
		}
		//隐藏并提交选中的活动信息
		function closeActive() {
			$(".active_list").hide();
		}
		//新增地址
		function add_page() {
			H.$openWin("user_shop_address_add_header", "../me/user_shop_address_add_header.html");
		}


		H.ready(function() {
			contents = H.$getPageParam();
			//			alert(JSON.stringify(contents));
			api.getPrefs({
				key : 'userinfo'
			}, function(ret, err) {
				retabc = eval("(" + ret.value + ")");
				get_data();
			});
			//监听地址改变
			api.addEventListener({
				name : 'addressChange'
			}, function(ret, err) {
				location.reload();
			});
		});
	</script>
</html>