<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<link rel="stylesheet" type="text/css" href="../../../css/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../../css/tools/loading.css"/>
		<style type="text/css">
			p.goods-title {
				font-size: 1em;
				color: #333;
			}
			p.goods-info {
				font-size: 12px;
				color: #999;
			}
			.aui-line-x {
				margin: 5px 0;
			}
			.aui-line-x:after {
				border-color: #ddd;
			}
			.goods-price {
				font-size: 0.875em;
			}
			.goods-price strong {
				margin: 0 5px;
				font-size: 16px;
			}
			.shop_title {
				height: 42px;
				overflow: hidden;
			}
			p.goods-title {
				font-size: 1em;
				color: #333;
			}
			p.goods-info {
				font-size: 12px;
				color: #999;
			}
			.goodss-info {
				font-size: 10px !important;
				line-height: 31px !important;
			}
			.ic_shop_ad {
				width: 80px;
				margin-top: 30px;
			}
		</style>
	</head>
	<body>
		<div class="aui-content" id="shopdata_body"></div>
		<div id="ic_loading" style="display: none;">
			<img src="../../../image/loading.png" />
			<h6>
			<div class="spinner">
				<div class="spinner-container container1">
					<div class="circle1"></div>
					<div class="circle2"></div>
					<div class="circle3"></div>
					<div class="circle4"></div>
				</div>
				<div class="spinner-container container2">
					<div class="circle1"></div>
					<div class="circle2"></div>
					<div class="circle3"></div>
					<div class="circle4"></div>
				</div>
				<div class="spinner-container container3">
					<div class="circle1"></div>
					<div class="circle2"></div>
					<div class="circle3"></div>
					<div class="circle4"></div>
				</div>
			</div></h6>
		</div>
		<script id="shopdata" type="text/html">
			<ul class="aui-list-view aui-grid-view" >
			{{# for(var i = 0, len = d.retValue.length; i < len; i++){ }}
			<li class="aui-list-view-cell aui-img aui-col-xs-6" tapmode onclick="openGoods({{ d.retValue[i].id }})">
			<img class="aui-img-object" src="http://122.114.90.191/{{ d.retValue[i].img }}">
			<div class="aui-img-body aui-text-left">
			<div class="shop_title">{{ d.retValue[i].name }}</div>
			<p>
			<span class="goods-price aui-text-danger">¥<strong>{{ d.retValue[i].sell_price }}</strong>元</span>
			<span class=" aui-pull-right goodss-info">
			市场价<span class="aui-text-danger">{{ d.retValue[i].market_price }}</span>元
			</span>
			</p>
			</div>
			</li>
			{{# } }}
			</ul>
		</script>
		<!--无网络提示 start-->
		<div style="text-align: center" id="ic_nonetwork"><img src="../../../image/loading.png" width="70" height="70" />
			<br />
			<span style="font-size:12px; margin-bottom: 10px;" class="aui-block"></span>
			<div class="aui-btn aui-btn-default" id="reload_page" tapmode>
				重新加载
			</div>
		</div>
		<!--无网络提示 end-->
		<script type="text/javascript" src="../../../script/AHelper.js"></script>
		<script type="text/javascript" src="../../../script/zepto.min.js"></script>
		<script type="text/javascript" src="../../../script/laytpl.js"></script>
		<script type="text/javascript">
			var goods_id, order;
			function openGoods(goodId) {
				H.$openWin('shop_show_header', '../shop_show_header.html', {
					goodId : goodId
				});
			}

			Zepto(function($) {
				//  网络重新加载处理
				$("#reload_page").on('tap', function() {
					location.reload();
				});
			});
			H.ready(function() {
				goods_id = H.$getPageParam();
//				console.log(JSON.stringify(goods_id));
				switch (goods_id.order) {
					case 0:
						order = 'new';
						break;
					case 1:
						order = 'visit';
						break;
					case 2:
						order = 'price';
						break;
				}
				$("#ic_loading").show();
				api.getPrefs({
					key : 'userinfo'
				}, function(ret, err) {
					var retobj = eval('(' + ret.value + ')');
					//1.1 请求商品列表
					api.ajax({
						url : window.serverUrl + '/goods_list/token/' + retobj.token + '/user_id/' + retobj.id + '/cat/' + goods_id.id + '/order/' + order
					}, function(ret, err) {
						if (1 == ret.retCode && ret) {
							//alert(JSON.stringify(ret.retValue));
							var tpl = document.getElementById('shopdata').innerHTML;
							//读取模版
							$("#ic_loading").hide();
							laytpl(tpl).render(ret, function(render) {
								//H.$recoverDropdownToNormal();
								document.getElementById('shopdata_body').innerHTML = render;
							});
						} else {
							$("#ic_loading").hide();
							if (0 == ret.retCode && ret) {
								$("#ic_nonetwork").show();
								$("#ic_nonetwork span").text(ret.retDesc);
							} else {
								$("#ic_nonetwork").show();
								$("#ic_nonetwork span").text(err.msg);
							}
						}
					});
				});
			});
		</script>
	</body>
</html>