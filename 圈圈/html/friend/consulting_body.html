<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<title>诊疗body</title>
		<link rel="stylesheet" type="text/css" href="../../css/aui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/fonts/iconfont.css"/>
		<style>
			.aui-ellipsis-pp {
				font-size: 10px;
				margin-bottom: 6px;
			}
			.aui-ellipsis-1 {
				font-size: 14px;
			}
			.intro {
				margin-top: 8px;
			}
			.aui-img-body i {
				font-size: 17px;
				font-style: normal;
				color: #ff4300;
				margin-left: 13px;
			}
			.aui-user-view-cell .aui-img-object {
				width: 48px !important
			}
			.aui-user-view-cell:active {
				background: #f5f5f5
			}
		</style>
	</head>
	<body>
		<div class="aui-toast" id="loading">
			<div class="aui-toast-loading"></div>
			<div class="aui-toast-content">
				加载中
			</div>
		</div>
		<div class="aui-content" id="doctor_list_html"></div>
		<script id="doctor_list_data" type="text/html">
			<ul class="aui-user-view">
			<!--加载医师信息的循环-->
			{{# for(var i = 0, len = d.retValue.length; i < len; i++){ }}
			<!--医师信息-->
			<li class="aui-user-view-cell aui-img" tapmode onclick="to_doctor({{ d.retValue[i].id }});">
			<img class="aui-img-object aui-pull-left" src="http://q.endzk.com/{{ d.retValue[i].pic }}">
			<div class="aui-img-body">
			<span>{{ d.retValue[i].name }}<i>{{ d.retValue[i].stars }}</i>{{# if (d.retValue[i].isauthent == 1){ }}<em><img src="../../image/friend/rzys.png" style="width: 80px;"/></em>{{# }}}</span>
			<p class='aui-ellipsis-1'>
			{{ d.retValue[i].jobname}}
			</p>
			<p class="aui-ellipsis-pp">
			{{ d.retValue[i].from }}
			</p>
			</div>
			<div class="aui-line-x"></div>
			<h5 class="intro">专长：{{ d.retValue[i].expertise }}</h5>
			</li>
			<!---->
			{{# } }}
			</ul>
		</script>
	</body>
	<script type="text/javascript" src="../../script/AHelper.js"></script>
	<script type="text/javascript" src="../../script/zepto.min.js"></script>
	<script type="text/javascript" src="../../script/laytpl.js"></script>
	<script>
	
		var retabc = null;
		//医生详情跳转
		function to_doctor(id) {
			H.$openWin("consulting_doctor_header", "consulting_doctor_header.html", {
				id : id
			});
		}

		//获取数据并渲染
		function get_data() {
			//请求ajax数据
			api.ajax({
				url : window.serverUrl + '/doctor_list/token/' + retabc.token
			}, function(ret, err) {
				if (ret && ret.retCode == 1) {
					var t = document.getElementById('doctor_list_data').innerHTML;
					laytpl(t).render(ret, function(render) {
						api.setPrefs({
							key : 'doctor_list',
							value : JSON.stringify(ret)
						});
						document.getElementById('doctor_list_html').innerHTML = render;
						H.$recoverDropdownToNormal();
						H.$api.css(H.$api.byId("loading"), "display:none");
					});
				} else {
					H.$api.css(H.$api.byId("loading"), "display:none");
					H.$openFrame('noNetwork', 'widget://res/noNetwork_body.html', {}, {
						x : 0,
						y : 55
					})
				}
			});
		}


		H.ready(function() {
			api.refreshHeaderLoading();
			api.getPrefs({
				key : 'userinfo'
			}, function(ret, err) {
				retabc = eval("(" + ret.value + ")");
				api.getPrefs({
					key : 'doctor_list'
				}, function(ret, err) {
					//如果有缓存数据
					if (ret && ret.value) {
						var t = document.getElementById('doctor_list_data').innerHTML;
						laytpl(t).render(eval('(' + ret.value + ')'), function(render) {
							document.getElementById('doctor_list_html').innerHTML = render;
							H.$api.css(H.$api.byId("loading"), "display:none");
							H.$recoverDropdownToNormal();
						});
					} else {
						//如果没有缓存数据
						get_data();
					}
				});
			});
			/*下拉刷新*/
			H.$dropdownToRefresh(function(ret, err) {
				get_data();
			});
		});
		Zepto(function($) {
		});
	</script>
</html>