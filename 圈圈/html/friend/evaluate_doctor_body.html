<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>医生评价body</title>
		<link rel="stylesheet" type="text/css" href="../../css/aui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/fonts/iconfont.css"/>
		<style>
			.wenzhen_btn_wen {
				color: #fff;
				position: fixed;
				bottom: 0;
				border-radius: 0;
				margin: 0;
				border: 0;
				background: -webkit-gradient(linear, left top, left bottom, from(#ff7f27), to(#ff6001));
			}
			.wenzhen_btn_wen:active {
				background: -webkit-gradient(linear, left top, left bottom, from(#ff6001), to(#ff9001));
			}
			.aui-input-row .aui-input-addon {
				padding-left: 20px;
			}
			.bsy {
				font-size: 12px;
				color: #A0A0A0;
				margin-left: 20px;
			}
			.aui-input-rows:first-child:after {
				border-top: 0
			}
			.aui-input-rows {
				display: block;
				padding: 0
			}
			.pj {
				height: 40px;
				line-height: 40px;
				font-size: 13px;
				padding-left: 20px;
			}
			.aui-pull-right {
				padding-top: 5px;
				padding-right: 9px;
			}
		</style>
	</head>
	<body>
		<div class="aui-form" style="margin-bottom: 15px;padding-top: 10px">
			<span class="bsy">满意度</span>
			<div class="aui-input-row">
				<label class="aui-input-addon">非常满意</label>
				<input class="aui-pull-right aui-radio" type="radio" issf="1" name="demo" checked>
			</div>
			<div class="aui-input-row">
				<label class="aui-input-addon">满意</label>
				<input class="aui-pull-right aui-radio aui-radio-info" type="radio" issf="2" name="demo">
			</div>
			<div class="aui-input-row">
				<label class="aui-input-addon">不满意</label>
				<input class="aui-pull-right aui-radio aui-radio-success" type="radio" issf="3" name="demo" >
			</div>
		</div>
		<div class="aui-content" style="background: #fff">
			<span class="pj">评价<div class="aui-pull-right" id="jRate"></div></span>
			<div id="demo-onchange-value"></div>
			<div class="aui-form">
				<div class="aui-input-row aui-input-rows">
					<textarea class="aui-input" placeholder="请给您的給此次的問診做一个详细的評價" id="content" style="height: 140px;"></textarea>
				</div>
			</div>
		</div>
		<!--撑开下部层页面-->
		<div style="height:10px;"></div>
		<!--撑开下部层页面-->
		<!--我要问诊-->
		<div class="aui-btn aui-btn-block wenzhen_btn_wen" id="consulting">
			提交评价
		</div>
		<!--我要问诊-->
	</body>
	<script type="text/javascript" src="../../script/AHelper.js"></script>
	<script type="text/javascript" src="../../script/star/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="../../script/star/jRate.js"></script>
	<script type="text/javascript">

		var retobj = null, result = null, doctorid = null;
		$("#jRate").jRate({
			backgroundColor : 'white',
			startColor : '#ff7f27',
			endColor : '#ff7f27',
			strokeColor : 'black',
			opacity : 0.3,
			precision : 0.1,
			onChange : function(rating) {
				//					$('#demo-onchange-value').text("Your Rating: " + rating);
				result = rating;
			}
		});
		$("#consulting").on("click", function() {
			try {
				var content = $("#content").text();
				var isSatisfied = $("input").attr("issy");
				if (result) {
					result = 5;
				}
				if (content) {
					api.ajax({
						url : window.serverUrl + '/doctor_evaluate_add/token/' + retobj.token + '/user_id/' + retobj.id,
						method : 'post',
						data : {
							values : {
								"doctorid" : doctorid.doctor_id.id,
								"content" : content,
								"isSatisfied" : isSatisfied,
								"star" : result
							}
						}
					}, function(ret, err) {
						api.toast({
							msg : ret.retDesc
						});
						api.hideProgress();
						//					if (ret && ret.retCode == 1) {
						//						H.$openWin("consulting_doctor_header", "consulting_doctor_header.html");
						//					} else {
						//						api.toast({
						//							msg : ret.retDesc
						//						});
						//					}
					});
				} else {
					api.toast({
						msg : '未添加文本'
					});
				}
			} catch(err) {
				alert(err.message);
			}
		});
		H.ready(function() {

			doctorid = H.$getPageParam();
			api.getPrefs({
				key : 'userinfo'
			}, function(ret, err) {
				retobj = eval('(' + ret.value + ')');
			});
			$("#jRate").jRate({
				backgroundColor : 'white',
				startColor : '#ff7f27',
				endColor : '#ff7f27',
				strokeColor : 'black',
				opacity : 0.3,
				precision : 0.1,
				onChange : function(rating) {
					//					$('#demo-onchange-value').text("Your Rating: " + rating);
					result = rating;
				}
			});
		
		});
	</script>
</html>