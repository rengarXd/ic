<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>问答详情body</title>
		<link rel="stylesheet" type="text/css" href="../../css/aui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/fonts/iconfont.css"/>
		<style>
			.img-cont img {
				max-width: 45px;
				height: 45px;
				line-height: 45px;
				border-radius: 50%;
				margin-right: 11px;
			}
			.aui-content-title {
				background: #fff;
				padding: 15px;
				font-size: 18px;
			}
			.aui-list-view:after {
				border: 0
			}
			.aui-img {
				width: 100%
			}
			.aui-col-xs-4 {
				padding-right: 5px;
			}
			.aui-ellipsis-1 {
				white-space: inherit;
			}
			#answers_body img {
				width: 35px !important;
				height: 35px !important
			}
			.noaskicon {
				font-size: 40px;
				color: #ddd;
				line-height: 40px;
			}
		</style>
	</head>
	<body>
		<div class="aui-content">
			<ul class="aui-list-view">
				<div class="aui-line-x"></div>
				<li class="aui-list-view-cell" tapmode>
					<div class="img-cont"><img class="aui-pull-left" src="../../image/friend/pic01.png" tapmode >
					</div>
					<div class="aui-img-body">
						<span id="answer_name">&nbsp;&nbsp;&nbsp;</span><b class="aui-pull-right" style="">#楼主</b>
						<p class='aui-ellipsis-1' id="answer_from">
							来自：&nbsp;&nbsp;&nbsp;
						</p>
					</div>
					<p style="margin-top: 5px; margin-bottom: 5px;" id="answer_content">
						&nbsp;&nbsp;&nbsp;
					</p>
					<div class="aui-content" style="display: inline-block;" id="an_photo">
						<div class="aui-col-xs-4"><img src="../../image/friend/20071120121953798_2.jpg" alt="" class="aui-img" />
						</div>
						<div class="aui-col-xs-4"><img src="../../image/friend/20071120121953798_2.jpg" alt="" class="aui-img" />
						</div>
					</div>
					<h6><span id="answer_time"></span>&nbsp;&nbsp;&nbsp;<span style="float: right" id="answer_askcount"></span></h6>
				</li>
			</ul>
		</div>
		<div class="aui-content" style="display: none;margin-bottom: 65px;" id="noask">
			<ul class="aui-list-view">
				<li class="aui-list-view-cell">
					<div>
						<center>
							<span class="iconfont icon-shafa noaskicon"></span>
							<br />
							<span style="font-size: 12px;
							color: #ddd;
							line-height: 26px;">沙发等你来坐</span>
						</center>
					</div>
				</li>
			</ul>
		</div>
		<div class="aui-content" style="margin-bottom: 60px;"  id="answers_body"></div>
		<script type="text/html" id="answers_data">
			<ul class="aui-user-view aui-in">
			{{# for (var i = 0, len = d.bbs_ask.length; i < len; i++) { }}
			<li class="aui-user-view-cell aui-img">
			<img class="aui-img-object aui-pull-left" src="http://q.endzk.com/{{ d.bbs_ask[i].head_ico }}">
			<div class="aui-img-body">
			<span>{{ d.bbs_ask[i].username }}<em>{{ d.bbs_ask[i].time }}</em></span>
			<p class='aui-ellipsis-1'>
			{{ d.bbs_ask[i].content }}
			</p>
			</div>
			</li>
			{{# } }}
			</ul>
		</script>
	</body>
	<script type="text/javascript" src="../../script/AHelper.js"></script>
	<script type="text/javascript" src="../../script/zepto.min.js"></script>
	<script type="text/javascript" src="../../script/laytpl.js"></script>
	<script>
		var photoBrowser;
		Zepto(function($) {
			$("#an_photo").on("tap", function() {
				//记录路径
				var photoBrowserPath = [];
				var imgs = $("#an_photo img");
				for (var i = 0; i < imgs.length; i++) {
					photoBrowserPath.push(imgs[i].src);
				}
				photoBrowser.open({
					images : photoBrowserPath,
					activeIndex : 0,
					placeholderImg : 'widget://res/img/loading_more.gif',
					bgColor : '#000'
				}, function(ret) {
					//					alert(JSON.stringify(ret));
					//如果单击则退出浏览
					if (ret.eventType == "click") {
						photoBrowser.close();
					}
				});
			});
		});
		function get_data() {
			var bbs = H.$getPageParam();
			api.getPrefs({
				key : 'userinfo'
			}, function(ret, err) {
				var answers = eval('(' + ret.value + ')');
				H.$ajax(function(ret, err) {
					if (ret && ret.retCode == 1) {
						//						alert(JSON.stringify(ret.retValue));
						$("#answer_headico").src = window.serverUrlPath + ret.retValue.bbscontent[0].head_ico;
						$("#answer_name").html(ret.retValue.bbscontent[0].username);
						$("#answer_from").html(ret.retValue.bbscontent[0].fromdevice);
						$("#answer_content").html(ret.retValue.bbscontent[0].content);
						$("#answer_time").html(ret.retValue.bbscontent[0].time);
						$("#answer_askcount").html("回复(" + ret.retValue.bbscontent[0].askcount + ")");
						if (ret.retValue.bbs_ask.length < 1) {
							$("#noask").show();
						} else {
							//						对文档区域进行渲染
							var tpl = document.getElementById('answers_data').innerHTML;
							laytpl(tpl).render(ret.retValue, function(render) {
								document.getElementById('answers_body').innerHTML = render;
							});
						}
					} else {
						alert(JSON.stringify(err));
					}
				}, window.serverUrl + '/ask_list/token/' + answers.token + '/bbsid/' + bbs.id);
			});
		}


		H.ready(function() {
			get_data();
			/*下拉刷新*/
			H.$dropdownToRefresh(function(ret, err) {
				get_data();
				H.$recoverDropdownToNormal();
			});
			photoBrowser = api.require('photoBrowser');
			var inputField = api.require('inputField');
			inputField.open({
				bgColor : '#e5e5e5',
				lineColor : '#DDDDDD',
				fileBgColor : '#fcfcfc',
				borderColor : '#ffffff',
				sendImg : 'widget://res/ask/sendimg.png',
				maxLines : 3,
				fixedOn : api.frameName
			}, function(ret) {
				api.toast({
					msg : ret.msg
				});
			});
			inputField.setPlaceholder({
				placeholder : '相信你的评论可以一针见血'
			});
		});
	</script>
</html>