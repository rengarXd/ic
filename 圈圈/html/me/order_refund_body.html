<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>我的退款body</title>
		<link rel="stylesheet" type="text/css" href="../../css/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../css/fonts/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../../css/tools/loading.css"/>
		<style>
			.aui-list-view-cell {
				font-size: 14px;
			}
			.aui-col-xs-12 {
				display: inline-block;
			}
			.ic_status {
				color: #f50 !important;
				font-weight: 800;
			}
			.ic_price {
				color: #F10F0F !important;
				font-size: 15px;
				font-weight: 800;
			}
			.ic_type {
				color: #0DA73E !important
			}
		</style>
	</head>
	<body>
		<div class="aui-content" id="refund_html" style="padding-top: 10px;">
			<!--页面加载中-->
			<div style="text-align: center" id="ic_loading"><img src="../../image/loading.png" width="70" height="70" />
				<br />
				<span>加载中...</span>
			</div>
			<!--页面加载中-->
		</div>
		<script id="refund_data" type="text/html">
			<ul class="aui-list-view" >
			{{# for(var i = 0, len = d.retValue.length; i < len; i++){ }}
			<li class="aui-list-view-cell" >
			<div class="aui-col-xs-12" onclick="openRefund({{ d.retValue[i].id }});">
			<span class="aui-pull-left">
			<span class="iconfont icon-dingdan"></span> 订单编号：{{ d.retValue[i].order_no }}
			</span><span class="aui-pull-right ic_status">{{# if(d.retValue[i].pay_status==0){ }}申请退款中{{# }else if(d.retValue[i].pay_status==1){ }}退款失败{{# }else if(d.retValue[i].pay_status==2){ }}退款成功{{# } }}</span>
			</div>
			<div class="aui-col-xs-12">
			<span class="aui-pull-left">
			日期：{{ d.retValue[i].time }}
			</span>
			{{# if(d.retValue[i].pay_status==2){ }}
			<span class="aui-pull-right ic_price">￥{{ d.retValue[i].amount }}</span>
			</div>
			<!--<div class="aui-col-xs-12">
			<span class="aui-pull-right iconfont icon-shanchu" onclick="deleteRefund();"></span>
			</div>-->
			{{# }else{ }}
			<span class="aui-pull-right iconfont icon-shanchu" onclick="deleteRefund({{ d.retValue[i].id }});"></span>
			</div>
			{{# } }}
			</li>
			{{# } }}
			</ul>
		</script>
	</body>
	<script type="text/javascript" src="../../script/AHelper.js"></script>
	<script type="text/javascript" src="../../script/zepto.min.js"></script>
	<script type="text/javascript" src="../../script/laytpl.js"></script>
	<script type="text/javascript">
		var userobj = null, refunds = null, refundobj = null;
		Zepto(function($) {
		});
		function openRefund(id) {
			H.$openWin("shop_refunds_detail_header", "refunds/shop_refunds_detail_header.html", {
				id : id
			});
		}

		function deleteRefund(id) {
			api.confirm({
				title : '删除退款申请',
				msg : '您确定要删除退款申请吗？',
				buttons : ['确定', '取消']
			}, function(ret, err) {
				if (ret.buttonIndex == 1) {
					api.showProgress({
						title : '提交中'
					});
					api.ajax({
						url : window.serverUrl + '/refunds_del/user_id/' + userobj.id + '/token/' + userobj.token + '/id/' + id
					}, function(ret, err) {
						if (ret) {
							api.hideProgress();
							alert(ret.retDesc);
							location.reload();
						} else {
							api.hideProgress();
							alert(err.msg);
							location.reload();
						}
					});
				}
			});
		}


		H.ready(function() {
			//		refunds = H.$getPageParam();
			//		alert(JSON.stringify(refundobj));
			api.getPrefs({
				key : 'userinfo'
			}, function(ret, err) {
				userobj = eval('(' + ret.value + ')');
				api.ajax({
					//1、请求所有订单 type = 1
					url : window.serverUrl + '/me_all_order/user_id/' + userobj.id + '/token/' + userobj.token + '/type/5'
				}, function(ret, err) {
					if (ret && ret.retCode == 1) {
						//2、如果有数据
						if (ret.retValue.length > 0) {
							var tpl = document.getElementById('refund_data').innerHTML;
							laytpl(tpl).render(ret, function(render) {
								document.getElementById('refund_html').innerHTML = render;
							});
						} else {
							//2.1、如果无数据
							$("#ic_loading span").text('抱歉暂无数据');
						}
					} else {
						$("#ic_loading span").text('抱歉暂无数据');
					}
				});
			});
		});
	</script>
</html>