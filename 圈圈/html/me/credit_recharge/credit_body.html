<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>余额充值body</title>
		<link rel="stylesheet" type="text/css" href="../../../css/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../../css/fonts/iconfont.css" />
		<style>
			.aui-input-addon {
				padding-left: 10px !important
			}
			.ic_zfb_icon {
				float: left;
				height: 18px;
				padding: 4px;
				color: #1B6BDA;
				font-size: 27px;
				margin-right: 10px;
			}
			.ic_zf_span {
				font-size: 12px;
				color: #A9A9A9;
			}
			.aui-btn-block {
				display: block;
				width: 100%;
				padding: 8px 0;
				margin-bottom: 0;
				font-size: 15px;
			}
			.ic_wxzf_icon {
				float: left;
				height: 18px;
				padding: 0 4px;
				color: #0D9E0E;
				font-size: 28px;
				margin-right: 10px;
			}
		</style>
	</head>
	<body>
		<div class="aui-content" style="padding-top:10px ">
			<div class="aui-form">
				<div class="aui-input-row">
					<div class="aui-input-addon">
						充值金额(元)：
					</div>
					<input type="number" class="aui-input" placeholder="请输入充值金额" id="pay_num"/>
				</div>
			</div>
		</div>
		<div class="aui-content" style="margin-top: 10px;">
			<div class="aui-form">
				<div class="aui-input-row">
					<label class="aui-input-addon aui-text-left"><span class="iconfont icon-zhifubao ic_zfb_icon"></span><h4>支付宝支付</h4><span class="ic_zf_span">推荐安装支付宝客户端的使用</span></label>
					<input class="aui-pull-right aui-checkbox aui-checkbox-info" type="radio" name="pay" checked="">
				</div>
				<div class="aui-input-row">
					<label class="aui-input-addon aui-text-left"><span class="iconfont icon-weixinzhifu ic_wxzf_icon"></span><h4>微信支付</h4><span class="ic_zf_span">推荐安装微信客户端的使用</span></label>
					<input class="aui-pull-right aui-checkbox aui-checkbox-info" type="radio" name="pay">
				</div>
			</div>
		</div>
		<div class="aui-content aui-padded-10">
			<div class="aui-btn aui-btn-danger aui-btn-block" tapmode id="submit_pay">
				确认支付
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../../script/AHelper.js"></script>
	<script type="text/javascript" src="../../../script/zepto.min.js"></script>
	<script type="text/javascript">
		var userobj = null;
		Zepto(function($) {
			$("#submit_pay").on('tap', function() {
				var pay_num = $("#pay_num").val();
				if (isPositiveNum(pay_num)) {
					configAliPay(userobj.id);
				} else {
					api.toast({
						msg : '抱歉您输入的金额有误！'
					});
					$("#pay_num").focus();
				}
			})
		});
		H.ready(function() {
			api.parseTapmode();
			api.getPrefs({
				key : 'userinfo'
			}, function(ret, err) {
				userobj = eval('(' + ret.value + ')');
			});
		});
		function isPositiveNum(s) {//是否为正整数
			var re = /^[0-9]*[1-9][0-9]*$/;
			return re.test(s)
		}

		function configAliPay(uid) {
			var obj = api.require('aliPay');
			obj.config({
				partner : '2088221727149058',
				seller : 'zzwecool@qq.com',
				rsaPriKey : 'MIICeQIBADANBgkqhkiG9w0BAQEFAASCAmMwggJfAgEAAoGBAN3wGG32qmWrgGagIU/Ayh0iPn4jyggoaWMX4YCAxfbAQ6fM0+Rf54d7DRLYeAPZ3nFN9XLLlM3ABKG4CVrE7p3yIfb4qgIkZVww3quJbxV+Yc0JPf8HIj/PWYyZTNZQigi/Ne7GA05aPgxd/2X+DXL07tCi6+fXOBP3DsoKFjetAgMBAAECgYEA16cSBd/WKR6hkJbuZ3F8sxxwPt+F07F43fn5e4UlVyPxWZ6VEmcCMcompPZEf/F2zQAkjRw2hkqb9Yw/Qrzy4iWF+Ao3aPAfXowexnUjcpP+gGDWSZDEeEyduN4yoyLLw3VY2aiknOTFy0/R9ejcK/wKFwZyozNDc5SU1Bf2PF0CQQDvp9Iz4aK7C1pbUF38vz0scqWx58mbw0p+VrCyr+MqnoNSAtcOOTrL/a9rjox/S7QbVAe74mA5IO5sFkBxI53/AkEA7RLwX/JAuXUn4srlBmC5SJlu0//cVMYvPJ8XfoMepa9rrYLKNKJx2Ba1BQIeZjjiSzj/Ql+zXz0QdB+Sx7ICUwJBAM7VBsxx8tD9BlmCresBXZlrxOcaxVviGvuYc91zgVn5/hoci2AiMkV1xxzLpSQDwQhI6HfV8ve7HSo5thovBB8CQQCERT3R+mJ8Vs5DLfqsHUkjJV/9blKrBcwTIZxFHLj7ri0AqOlShpPIAZtLyQvW8sPnPkzE5oo4h+RnNbp6Kmo7AkEAmPe5eiCk+6OGsi3LRVMSgRg3khh87hNbZbiwagzeDhQN1vy6qxSQKrPrf4WhSPZ64H/DeRkgZTDmi0+In13qMA==',
				rsaPubKey : 'MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDd8Bht9qplq4BmoCFPwModIj5+I8oIKGljF+GAgMX2wEOnzNPkX+eHew0S2HgD2d5xTfVyy5TNwAShuAlaxO6d8iH2+KoCJGVcMN6riW8VfmHNCT3/ByI/z1mMmUzWUIoIvzXuxgNOWj4MXf9l/g1y9O7Qouvn1zgT9w7KChY3rQIDAQAB',
				notifyURL : 'http://122.114.90.191/pay/notify_test/user_id/'+uid
			}, function(ret, err) {
				if (ret.status)
					obj.pay({
						subject : '在线充值',
						body : 'i宠在线余额充值',
						amount : '0.01',
						tradeNO : userobj.id + Date.parse(new Date())
					}, function(ret, err) {
						var rets = JSON.stringify(ret);
						api.alert({
							title : '支付结果',
							msg : rets,
							buttons : ['确定']
						});
					});
			});
		};
	</script>
</html>