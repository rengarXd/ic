<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>title</title>
		<link rel="stylesheet" type="text/css" href="../../css/aui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/fonts/iconfont.css"/>
		<style>
			body {
			}
			.aui-bar-1d9dd5 {
				background: #1786FF;
			}
			.serach_in {
				width: 100%;
				-moz-border-radius: 4px;
				-khtml-border-radius: 4px;
				-webkit-border-radius: 4px;
				height: 31px;
				margin-top: 8px;
				margin-left: 6px;
				font-size: 13px;
				color: #bbb;
				line-height: 31px;
				padding-left: 6px !important;
				margin-bottom: 0 !important;
				border: 0 !important;
			}
			.sousuo_btn {
				top: -15px;
				color: #1c84f3;
				font-size: 20px;
				position: relative;
			}
		</style>
	</head>
	<body>
		<header class="aui-bar aui-bar-nav aui-bar-1d9dd5 header" id='search-header'>
			<div class="aui-col-xs-10" style="line-height: 0;text-align: right">
				<div class="aui-searchbar-input">
					<form action="javascript:search();">
						<input class="serach_in" type="search" placeholder="大家都在搜：犬类腹泻" id="search-input">
					</form>
				</div>
				<!--				<span class="iconfont icon-sousuo sousuo_btn" style="display: none;" id="icon_btn"></span>-->
			</div>
			<div class="aui-col-xs-2">
				<a class="aui-pull-right" onclick="H.$closeCurrentWin();"> <span class="aui-iconfont "></span>取消 </a>
			</div>
		</header>
	</body>
	<script type="text/javascript" src="../../script/zepto.min.js"></script>
	<script type="text/javascript" src="../../script/AHelper.js"></script>
	<script type="text/javascript">
		H.ready(function() {
			//1.1 快速打开窗口 用户注册页面
			H.$openFrameWithNav('search-header', {
				url : 'search_body.html',
				name : 'search_body',
				pageParam : H.$getPageParam()
			});
			//1.2搜索框接收关键字
			api.addEventListener({
				name : 'keyword'
			}, function(ret, err) {
				var addkey = ret.value;
				$("#search-input").val(addkey);
				search();
			});
		});
		//设置焦点
		Zepto(function($) {
			$(".serach_in").focus();
		});
		//搜索框执行函数
		function search() {
			var content = H.$api.val(H.$api.byId("search-input"));
			if (content) {
				api.showProgress({
				title : '搜索中'
			});
				api.getPrefs({
					key : 'userinfo'
				}, function(ret, err) {
					//字符串转为json对象
					var retobj = eval('(' + ret.value + ')');
					//发送搜索数据
					api.ajax({
						url : window.serverUrl + '/app_index_search/token/' + retobj.token + '/word/' + content
					}, function(ret, err) {
						//如果请求有数据返回
						if (ret && ret.retCode == 1) {
							//						alert(JSON.stringify(ret));
							api.sendEvent({
								name : 'searchreload',
							});
							//							api.execScript({
							//								frameName : 'consulting_from_body',
							//								script : 'get_data();'
							//							});
						} else {
							//						if (ret && ret.retCode == 0) {
							//						}
							alert(JSON.stringify(err));
						}
					});
				});
			} else {
				api.alert({
					title : '搜索提示',
					msg : '您没有输入任何内容'
				});
			}
						cancelSearch();
		}
				//取消搜索
				function cancelSearch() {
					H.$api.removeCls(H.$api.dom(".aui-searchbar-input.focus"), "focus");
		//			H.$api.val(H.$api.byId("search-input"), '');
					H.$api.dom('.aui-searchbar-input input').blur();
				}
	</script>
</html>